## 第六章  集合引用类型

### 6.1、Object

- 到目前为止，大多数引用值的示例使用的是 Object 类型。Object 是ECMAScript中最常用的类型之一。显式地创建 Object 的实例有两种方式。第一种是使用 **new 操作符**和 Object 构造函数，如下所示：

```js
let person = new Object(); 
person.name = "Nicholas"; 
person.age = 29;
```

- 另一种方式是使用**对象字面量**（object literal）表示法。下面的代码定义了与前面示例相同的 person 对象，但使用的是对象字面量表示法：

```js
let person = { 
    name: "Nicholas", 
    age: 29
};
```

- 在对象字面量表示法中，属性名**可以是字符串或数值，**比如指定了 name 属性，后跟一个冒号，然后是属性的值。逗号用于在对象字面量中分隔属性

```js
let person = {
    "name": "Nicholas", 
    "age": 29, 
    5: true 
};

- 这个例子会得到一个带有属性 name 、 age 和 5 的对象。注意，数值属性会自动转换为字符串。
```

- 然也可以用对象字面量表示法来定义一个**只有默认属性和方法的对象，**只要使用一对大括号，中间留空就行了：

```js
let person = {}; // 与new Object()相同
person.name = "Nicholas";
person.age = 29;

注意：实际上开发者更倾向于使用对象字面量表示法。这是因为对象字面量代码更少，看起来也更有封装所有相关数据的感觉。
```

### 6.2、Array

#### 6.2.1 创建数组

- 有几种基本的方式可以创建数组。一种是使用 **Array 构造函数，**比如：

```js
let colors = new Array();
```

- 在使用 Array 构造函数时，也可以**省略 new 操作符。**结果是一样的，比如：

```js
let colors = Array(3); // 创建一个包含3个元素的数组
let names = Array("Greg"); // 创建一个只包含一个元素，即字符串"Greg"的数组
```

- 另一种创建数组的方式是使用**数组字面量**（array literal）表示法。数组字面量是在中括号中包含以逗号分隔的元素列表，如下面的例子所示：

```js
let colors = ["red", "blue", "green"]; // 创建一个包含3个元素的数组
let names = []; // 创建一个空数组
let values = [1,2,]; // 创建一个包含2个元素的数组
```

#### 6.2.2 数组索引

- 要取得或设置数组的值，需要使用中括号并提供相应值的数字索引，如下所示：

```js
let colors = ["red", "blue", "green"]; // 定义一个字符串数组
alert(colors[0]); // 显示第一项
colors[2] = "black"; // 修改第三项
colors[3] = "brown"; // 添加第四项
```

- 数组中元素的数量保存在 length 属性中，这个属性始终返回**0或大于0**的值，如下例所示：

```js
let colors = ["red", "blue", "green"]; // 创建一个包含3个字符串的数组
let names = []; // 创建一个空数组
alert(colors.length); // 3 
alert(names.length); // 0
```

- 数组 length 属性的独特之处在于，它不是只读的。通过修改length 属性，可以从数组**末尾删除或添加元素。**来看下面的例子：

```js
let colors = ["red", "blue", "green"]; // 创建一个包含3个字符串的数组
colors.length = 2; 
alert(colors[2]); // undefined

- 这里，数组 colors 一开始有3个值。将 length 设置为2，就删除了最后一个（位置2的）值，因此 colors[2] 就没有值了。
```

#### 6.2.3 检测数组

- 一个经典的ECMAScript问题是**判断一个对象是不是数组。**在只有一个网页（因而只有一个全局作用域）的情况下，使用 **instanceof** 操作符就足矣：

```js
var arr = [4,67,23];
arr instanceof Array  //return true
```

```js
Array.isArray() 方法

console.log(Array.isArray([])); // true
console.log(Array.isArray({})); // false
console.log(Array.isArray(123)); // false
console.log(Array.isArray('123')); // false
```

#### 6.2.4 转换方法

- 所有对象都有 **toLocaleString() 、 toString() 和 valueOf() 方法。**其中， **valueOf()** 返回的还是**数组本身。**而**toString()** 返回由数组中每个值的等效字符串**拼接而成的一个逗号分隔的字符串。**也就是说，对数组的每个值都会调用其 toString() 方法，以得到最终的字符串。来看下面的例子：

```js
let colors = ["red", "blue", "green"]; // 创建一个包含3个字符串的数组
alert(colors.toString()); // red,blue,green
alert(colors.valueOf()); // red,blue,green 
alert(colors); // red,blue,green

- 首先是被显式调用的 toString() 和 valueOf() 方法，它们分别返回了数组的字符串表示，即将所有字符串组合起来，以逗号分隔。
```

- 如果想使用**不同的分隔符，**则可以**使用 join() 方法。** join() 方法接收一个参数，即字符串分隔符，返回包含所有项的字符串。来看下面的例子：

```js
let colors = ["red", "green", "blue"]; 
alert(colors.join(",")); // red,green,blue 
alert(colors.join("||")); // red||green||blue

- 如果不给 join() 传入任何参数，或者传入 undefined ，则仍然使用逗号作为分隔符。

- 注意：如果数组中某一项是 null 或 undefined ，则在 join() 、 toLocaleString() 、 toString() 和 valueOf() 返回的结果中会以空字符串表示。
```

#### 6.2.5 排序方法

- 数组有**两个方法**可以用来**对元素重新排序： reverse() 和 sort() 。**顾名思义， **reverse()** 方法就是将数组元素**反向排列。**比如：

```js
let values = [1, 2, 3, 4, 5]; 
values.reverse(); 
alert(values); // 5,4,3,2,1
```

-  **sort()** 会按照**升序重新排列数组元素，**即最小的值在前面，最大的值在后面。为此， sort() 会在每一项上调用 String()转型函数，然后比较字符串来决定顺序。即使数组的元素都是数值，也会先把数组转换为字符串再比较、排序。比如：

```js
let values = [0, 1, 5, 10, 15]; 
values.sort(); 
alert(values); // 0,1,10,15,5
```

-  sort() 方法可以接收一个**比较函数，**用于判断哪个值应该排在前面。

```js
function compare(value1, value2) { 
    if (value1 < value2) { 
        return -1; 
    } else if (value1 > value2) { 
        return 1; 
    } else { 
        return 0; 
    } 
}
```

- 这个比较函数可以适用于大多数数据类型，可以把它当作参数传给sort() 方法，如下所示：

```js
let values = [0, 1, 5, 10, 15]; 
values.sort(compare); 
alert(values); // 0,1,5,10,15
```

## 6.3、Set

- ECMAScript 6新增的 **Set** 是一种新集合类型，为这门语言带来集合数据结构。 Set 在很多方面都**像是加强的 Map ，**这是因为它们的大多数API和行为都是共有的。

#### 6.3.1 基本API

- 使用 **new 关键字和 Set** 构造函数可以创建一个**空集合：**

```js
const m = new Set();
```

- 与 Map 类似， Set 可以包含任何JavaScript数据类型作为值。集合也使用SameValueZero操作（ECMAScript内部定义，无法在语言中使用），基本上相当于使用严格对象相等的标准来检查值的匹配性。

```js
const s = new Set(); 
const functionVal = function() {};
const symbolVal = Symbol();
const objectVal = new Object();
s.add(functionVal); 
s.add(symbolVal); 
s.add(objectVal);
alert(s.has(functionVal)); // true 
alert(s.has(symbolVal)); // true 
alert(s.has(objectVal)); // true

// SameValueZero检查意味着独立的实例不会冲突
alert(s.has(function() {})); // false
```

- **add() 和 delete()** 操作是幂等的。 delete() 返回一个布尔值，表示集合中是否存在要删除的值：

```js
const s = new Set(); 
s.add('foo'); 
alert(s.size); // 1
s.add('foo'); 
alert(s.size); // 1

// 集合里有这个值
alert(s.delete('foo')); // true

// 集合里没有这个值
alert(s.delete('foo')); // false
```

